# Orientview软件介绍与使用教程

[TOC]

### 一、介绍

> “OrientView是一款实时并排显示视频和地图的定向视频分析程序。支持许多图像和视频文件格式。路线由QuickRoute创建和校准。产生的视频可以导出到一个MP4视频文件。”
>
> <p align="right">——原作者的介绍</p>

简单地说，这是一个可以把视频和实时轨迹、地图结合一起显示出来的软件。同时，得益于其具有实时播放的功能，可以非常方便地应用于教学场景。

#### 1.1 下载地址

|          版本          |                             地址                             |
| :--------------------: | :----------------------------------------------------------: |
|  Windows 64位英文原版  | https://github.com/mikoro/orientview/releases/download/v1.1.0/OrientView-1.1.0-win.zip |
|    Mac OS X英文原版    | https://github.com/mikoro/orientview/releases/download/v1.1.0/OrientView-1.1.0-mac.zip |
|     Linux英文原版      |        https://aur.archlinux.org/packages/orientview/        |
| Windows 64位中文翻译版 | 此版本请移步至微信<br />微信关注“定向笔记”公众号，发送“定向视频软件”获取最新下载链接（此版本会持续更新） |
|        测试素材        | https://s3.amazonaws.com/orientview-testdata/orientview-testdata.zip<br />或者联系本文编者<br />或者方式同上 |



### 二、素材准备

> 三个素材：视频、GPX文件和地图。

视频和地图这两个大家应该都容易弄到，这里主要讲解GPX文件的获取与后期使用QuickRoute处理。

#### 2.1 GPX文件的获取

GPX文件是一种通用的地图信息文件，最简单的GPX文件仅包含了经纬度坐标点。根据设备的不同，还可以记录其他数据：心率、血氧量、加速度等。

能够记录GPX的设备有很多，比如部分运动相机、运动手表、智能手机等；但是提取GPX文件的方式却千差万别，这里提供部分参考：

|   设备   |                           提取方式                           |
| :------: | :----------------------------------------------------------: |
| 运动相机 | 目前市面上带GPS功能的运动相机基本都可以导出GPX文件，具体方法可以自行查找，或者寻求本文编者帮助。 |
| 运动手表 | 请参考知乎文章：[运动手表GPS轨迹文件导出方法](https://zhuanlan.zhihu.com/p/114283607)<br /><img src="D:\Orienteering\orientview\教程文档\figures\运动手表.jpg" alt="运动手表" style="zoom:30%;" /> |
| 智能手机 |      使用GPSLogger软件记录GPS数据，可以直接导出GPX文件       |

#### 2.2 GPX数据处理

参考教程：[教程 | 定向运动路线分析软件 - Quickroute 入门](https://mp.weixin.qq.com/s/lhrMRDdeKMm07HS1b83i-A)

本部分根据参考教程，只需要将路线调整好就可以了，不需要继续做分段等；而后，将路线调整为透明，然后导出为图片：

<img src="D:\Orienteering\orientview\教程文档\figures\调整为透明.png" alt="调整为透明" style="zoom:60%;" />

<center>调整路线为透明</center>

<img src="D:\Orienteering\orientview\教程文档\figures\导出.jpg" alt="导出" style="zoom:60%;" />

<center>导出为图片</center>

通过此方式导出的图片是一张带有轨迹数据的图片，只不过我们调整为透明看不见而已。



### 三、软件的各项配置

> 了解软件中：地图、路线、视频、分段、窗口、稳定化和编码器这七项设置；注意，并不是每一项都是必须配置的，例如教学时候并不需要设置编码器，视频如果比较稳定也不需要设置稳定化；以下使用**测试文件**进行演示，请给点耐心，这个软件没有看上去那么的复杂。（可以先导入测试文件）

#### 3.1 地图

<img src="D:\Orienteering\orientview\教程文档\figures\地图.jpg" alt="地图" style="zoom:60%;" />

**地图图片文件：**设置地图文件路径；可以直接使用刚刚导出的图片。（此处使用了测试文件中的图片）

**相对宽度：**设置地图占画面的大小，这里0.25表示占了25%的画面。

**地图头部：**去掉地图头部部分像素；这里解释一下，QuickRoute导出图片之后，会在地图顶部加入一个65像素高度的版本信息，所以这里设置为65；如果不去掉的话，轨迹会出现一个整体偏移。

<u>**其余未提及部分，参考我截图的设置，或者自行探索，下同。**</u>

#### 3.2 路线

<img src="D:\Orienteering\orientview\教程文档\figures\路线.jpg" alt="路线" style="zoom:60%;" />

**QuickRoute图片文件：**设置刚刚导出的图片的路径；前面已经提到了，导出的图片是带有轨迹数据的，只不过我们设置为透明，看不到而已。（此处使用了测试文件中的图片）

**校准：**这里用来调整轨迹时间，以匹配视频；当你预览视频的时候发现轨迹与视频不匹配时，可以在这里调整。

**显示：**该部分用来调整轨迹的显示方式，可以根据自己喜好去调整颜色、大小、尾巴长度等，可以参考截图中的设置。

**一般设置：**这里是地图相关各类杂项的设置，比如视图模式可以设置地图以运动员为中心显示还是以分段为中心显示，当轨迹显示不全的时候（跑错的时候会出现）也可以在这里设置，整体可以参考截图中的设置。

#### 3.3 视频

<img src="D:\Orienteering\orientview\教程文档\figures\视频.jpg" alt="视频" style="zoom:60%;" />

**导入视频文件：**设置视频文件的路径。（此处使用了测试文件中的视频）

**校准：**与路线中的校准功能一样。

**译码器设置：**该部分设置可以调整视频输出帧数，默认为1即可输出与原视频相同帧数的视频。

#### 3.4 分段

<img src="D:\Orienteering\orientview\教程文档\figures\分段.jpg" alt="分段" style="zoom:60%;" />

**类型：**可以使用绝对值或者相对值；绝对值就是从出发算起到打卡的时间，相对值就是从上一个打卡点算起到本次打卡的时间，也就是我们常说的分段用时。

**分段时间：**根据不同分段类型，填写分段时间，请注意填写的格式：每一个时间点的格式是“小时:分钟:秒”或者“小时.分钟.秒”，其中，小时和分钟不是必填的；时间点之间的分割符是“|”或者“;”；具体形式可以参考截图中填写的形式。**注意：必须使用英文字符**（此处使用了测试文件中的分段时间，可以导入测试文件中的.orv后缀的文件进行测试，但这可能会导致前面地图、路线和视频的路径空缺，需要重新填写，也可以参照截图填写前三个分段点做测试，因为测试视频并没有那么长）

#### 3.5 窗口

<img src="D:\Orienteering\orientview\教程文档\figures\窗口.jpg" alt="窗口" style="zoom:60%;" />

**设置：**这里设置输出视频的宽高，此处给出常用分辨率做参考：4K视频3840x2160，1080P视频1920x1080，720P视频1280x720，480P视频640x480。

#### 3.6 稳定化

<img src="D:\Orienteering\orientview\教程文档\figures\稳定化.jpg" alt="稳定化" style="zoom:60%;" />

勾选**“启用稳定化”**即可开启稳定化（可以不开启），有两种模式：实时和预处理。若选择实时，则下面无需继续设置。若选择预处理，则需要继续设置下面项目，虽然预处理的稳定效果会好于实时处理，但要求使用者有OpenCV相关知识，故在此不作翻译和介绍，有能力的朋友可以做尝试。

#### 3.7 编码器

<img src="D:\Orienteering\orientview\教程文档\figures\编码.jpg" alt="编码" style="zoom:60%;" />

**输出视频文件：**设置文件输出路径，包括文件名和扩展名。

**预设：**输出速度的选择，输出速度越快，CPU占用率会越高（如果你的电脑在编码导出视频的时候不需要干别的事情，那就选veryfast吧）。

**CRF：**视频压缩率；压缩率越大，编码压力越小，耗时越短，文件越小，码率越小，清晰度越低；压缩率越小，编码压力越大，耗时越长，文件越大，码率越大，清晰度越高。（这里要提一个点：视频清晰度主要是由视频码率决定的，分辨率对清晰度影响并不重要）

如果需要上传到媒体平台，需要留意平台限制的视频码率，此处提供一个参考：1080P分辨率下，CRF设置27或28，导出视频码率在6000kbps左右，该码率已经是国内大部分媒体平台的限制值。注意：压缩率和码率并不是线性关系，会受到分辨率与原视频内容的影响，请多尝试，以找到最合适的压缩率。



### 四、导出与演示

> 顶部菜单中的“播放”与“编码”

#### 4.1 导出

完成所有设置之后可以先点击“播放”按钮进行预览，左右方向键可以控制视频前进后退；预览完没问题了，点击“编码”按钮开始编码。

<img src="D:\Orienteering\orientview\教程文档\figures\编码开始.jpg" alt="编码开始" style="zoom:60%;" />

下方三个按钮，从左到右分别是“暂停”，“中止”，“打开”。中间的信息内容分别是“时间”，“帧”，“大小”。

#### 4.2 演示

为什么说这个软件可以应用于教学场景——这是其他视频剪辑软件做不到的——是因为他具有一个实时播放的功能，播放的时候可以随时切换地图的显示方式、放大地图、缩小地图等操作。一下列出部分操作：

|                    按键                    |                          行为                          |
| :----------------------------------------: | :----------------------------------------------------: |
|                     F1                     |                   打开/关闭信息面板                    |
|                     F2                     | 选中地图/视频/都不选中进行移动（此时按方向键可以移动） |
|                     F3                     |                    调整画面显示方式                    |
|                     F4                     |                    调整轨迹显示方式                    |
|                     F5                     |                    调整尾巴显示方式                    |
|                     F6                     |                    调整地图显示方式                    |
|                     F9                     |                     打开/关闭防抖                      |
|                    空格                    |        暂停/播放视频<br>Ctrl+空格 可以单帧跳转         |
| Ctrl+1<br />Ctrl+2<br />Ctrl+3<br />Ctrl+4 |   重置地图<br />重置视频<br />重置轨迹<br />重置时间   |
|           左方向键<br />右方向键           |                     后退<br />前进                     |
|                  Q<br />A                  |                 放大地图<br />缩小地图                 |
|                  W<br />S                  |           顺时针旋转地图<br />逆时针旋转地图           |
|                  E<br />D                  |             增加地图占比<br />减少地图占比             |
|                  Y<br />H                  |                 加粗轨迹<br />减细轨迹                 |

其他更多操作方式请移步至项目开源地址（7.1小节）参考



### 五、导出视频相关拓展

> 成功导出视频之后，大家可能发现一个问题，就是视频没有声音。

这是这个软件目前尚未完善的地方，不过我们可以用其他软件代替，前后操作不超过5分钟即可完成。

首先讲解一个知识点，我们常常看的视频、电影都是由许多轨道封装在一起的：视频轨道、音频轨道、字幕轨道、其他数据轨道（比如GPX）等。我们导出的视频缺少了音频轨道，所以没有声音，只需要将原视频的音频轨道封装到导出视频的音频轨道即可。

这里介绍一个软件：小丸工具箱，下载地址：https://dl.hdslb.com/video-press/xiaowantoolsrev194.zip（复制到浏览器打开）

首先在“抽取”页面下，打开原视频，点击“抽取音频1”，等待一两分钟即可在原视频目录下看到一个音频文件。这个就是原视频的音频。

<img src="D:\Orienteering\orientview\教程文档\figures\抽取.jpg" alt="抽取" style="zoom:60%;" />

然后在“封装”页面下，打开导出的视频，打开刚才抽取的音频，然后点击“封装”，即可在导出视频的目录下看到一个新生成的视频文件。这个就是带声音的导出视频。

<img src="D:\Orienteering\orientview\教程文档\figures\封装.jpg" alt="封装" style="zoom:60%;" />



### 六、报错与解决方法

如果打开软件时出现缺少.dll文件的报错，请尝试在https://www.dll-files.com/查找并下载缺少的dll文件，放入软件根目录并再次打开。

如出现其他问题，请联系本文编者微信：13302831843



### 七、项目开源

> 该软件其实是我逛GitHub发现的

#### 7.1 地址

项目原仓库地址：https://github.com/mikoro/orientview

鉴于原作者已经多年没打理仓库，似乎已经弃坑了，大家可以移步至我的分支下：https://github.com/WaterFishJ/orientview

#### 7.2 内核原理

软件界面用QT5软件设计，视频部分是调用OpenCV完成，编码部分是调用FFmpeg完成。

#### 7.3 待完善部分

软件还有许多部分需要完善和更新。目前软件的版本是2015年的版本，由于作者弃坑，很多ToDo也没有实现，比如加入视频声音。随着信息技术的发展，编码、防抖等技术也在进步，但软件还停留在2015年。希望有相关知识的定向爱好者加入到本项目的开发，欢迎联系本文编者微信：13302831843



### 八、致谢与关注

感谢冼成彬和蒲小年对本次软件翻译工作的支持，欢迎关注他们的微信公众号：

<img src="D:\Orienteering\orientview\教程文档\figures\定向笔记.jpg" alt="定向笔记" style="zoom:50%;" />

<center>定向笔记</center>



<img src="D:\Orienteering\orientview\教程文档\figures\一个定向boy.jpg" alt="一个定向boy" style="zoom:50%;" />

<center>一个定向boy</center>



<img src="D:\Orienteering\orientview\教程文档\figures\喜欢出去玩的水鱼WaterFish.jpg" alt="喜欢出去玩的水鱼WaterFish" style="zoom:10%;" />

<center>编者的微信公众号“喜欢出去玩的水鱼WaterFish”</center>